???????????????????????????????????????????????
VINCULAR PC Y CELULAR EN BOVEDA
???????????????????????????????????????????????

REQUISITO: Tener la app abierta en ambos dispositivos

PASO 1 - EN TU PC (Beach House):
- Abre https://boveda-khaki.vercel.app
- Ingresa tu contrase?a maestra
- Click en el icono de cadena ?? (arriba a la derecha)
- Aparece un QR grande

PASO 2 - EN TU CEL:
- Abre https://boveda-khaki.vercel.app
- SI ya tienes boveda creada:
  * Borra los datos: Settings > Clear site data
  * O usa navegador en modo incognito
- Te debe aparecer "Crea tu contrase?a maestra"
- ANTES de crear, click en ?? (abajo del form)

PASO 3 - ESCANEAR:
- En el cel, click "Escanear"
- Apunta la camara al QR de tu PC
- El codigo se captura automaticamente

PASO 4 - VINCULAR:
- El cel muestra el codigo capturado
- Click "Vincular"
- Aparece mensaje: "Dispositivo vinculado..."

PASO 5 - CREAR BOVEDA EN CEL:
- Ahora crea la boveda en tu cel
- USA LA MISMA CONTRASE?A MAESTRA del PC
- Exactamente igual, mayusculas y todo

PASO 6 - VERIFICAR:
- Desbloquea en el cel
- Deben aparecer tus contrase?as del PC
- Arriba dice "? Sincronizado desde nube"

LISTO! Ahora ambos dispositivos comparten datos.

Dime cuando llegues al paso que te atore.

? C16
[Arquitecto]   
Cuando escaneo con mi cel me dice "vinculado" y doy aceptar y me pide que ingrese contraseÃ±a maestra como si fuera primera vez (me pide confirmar) y le pongo la misma de la PC y aun asi no se vincula
  

[C16 CONSULTANT - DIAGNOSTICO]

OK, el flujo deberia funcionar asi:
1. Escaneas QR -> guarda user_id del PC en tu cel
2. Crear boveda -> busca en Supabase con ese user_id
3. Encuentra datos -> los descifra con tu contrase?a
4. Listo

Si te pide crear como primera vez Y no sincroniza, hay 2 posibles causas:

CAUSA A: Supabase no esta conectado
- La app crea boveda local sin sincronizar
- Necesito verificar las env vars

CAUSA B: No hay datos en Supabase para ese user_id
- El PC nunca subio datos a la nube
- O el user_id que escaneaste no tiene datos

VERIFICACION RAPIDA - EN TU PC:
1. Abre DevTools (F12)
2. Ve a Console
3. Escribe: localStorage.getItem('boveda_user_id')
4. Anota el resultado (algo como "user_xyz123...")

5. Ahora escribe: supabase
6. Si dice "null" = NO HAY CONEXION A SUPABASE

Pasame lo que te salga en ambos comandos.

? C16

[C16 CONSULTANT - ACTUALIZACION]

Las ENV VARS SI ESTAN en Vercel:
- NEXT_PUBLIC_SUPABASE_URL ?
- NEXT_PUBLIC_SUPABASE_ANON_KEY ?

Entonces el problema es otro. Posibilidades:

1. LA TABLA 'vaults' NO EXISTE EN SUPABASE
   - La app intenta guardar pero falla silenciosamente

2. EL PC NUNCA SUBIO A LA NUBE
   - Los datos solo estan en localStorage del PC
   - Nunca llegaron a Supabase

PARA VERIFICAR - EN TU PC:
Abre DevTools > Console y ejecuta:

localStorage.getItem('boveda_vault')

Si devuelve datos, estan guardados localmente.
Pero necesitamos ver si llegaron a Supabase.

TIENES ACCESO AL DASHBOARD DE SUPABASE?
- supabase.com > tu proyecto
- Table Editor > buscar tabla 'vaults'
- Ver si hay filas con datos

Si la tabla no existe o esta vacia, ahi esta el bug.

? C16
[Arquitecto]   
Si existe
[ARCHIVO] 2026-01-14T23-35-05_image.png -> /home/pvrolo/colmena/uploads/2026-01-14T23-35-05_image.png
  

[C16 CONSULTANT - ENCONTRADO EL PROBLEMA]

Vi la imagen. La tabla vaults EXISTE y tiene 5 user_ids diferentes:
- user_mke2adkhmaokck7w8t
- user_mkencyh13yyq9jw8tkq  
- user_mkec0x4i6h3r3e3sk89
- user_mkeg5wodofjsir1cwre
- user_mke1ogkaa5ilcfhttth7

ESTO SIGNIFICA: Cada dispositivo creo su propio user_id separado.

DIAGNOSTICO:
La vinculacion NO esta funcionando. Aunque escaneas el QR, el cel sigue creando un user_id nuevo.

VERIFICACION INMEDIATA:

EN TU PC (DevTools > Console):
localStorage.getItem('boveda_user_id')

EN TU CEL (Chrome > Menu > Herramientas de desarrollador):
localStorage.getItem('boveda_user_id')

DEBEN SER IGUALES para que sincronicen.

Si son diferentes, la vinculacion fallo.

POSIBLE BUG EN EL CODIGO:
handleLinkDevice borra el vault local pero cuando creas la boveda, 
la funcion handleSetup puede estar generando un nuevo user_id.

?Quieres que revise el codigo para encontrar el bug?

? C16
